# コスト見積もり：イメージボード作成ツール

## 📊 想定使用量

### 検証フェーズでの想定使用量
- **ユーザー数**: 1-5名（社内検証）
- **1日あたりの画像分析**: 10-20回
- **1日あたりのPinterest検索**: 30-60回（画像1枚につき3軸で検索）
- **月間の画像分析**: 300-600回
- **月間のPinterest検索**: 900-1,800回

---

## 💰 各サービスのコスト見積もり

### 1. Google Cloud Run（Next.jsアプリのホスティング）

#### 無料枠
- **リクエスト**: 月200万リクエストまで無料
- **CPU時間**: 月36万GB秒まで無料
- **メモリ**: 月36万GB秒まで無料

#### 想定リソース設定
- **CPU**: 1 vCPU
- **メモリ**: 512MB
- **最小インスタンス**: 0（コールドスタート許容）
- **最大インスタンス**: 2

#### コスト計算（月間想定）
- **リクエスト数**: 約2,000-3,000リクエスト/月
  - 画像アップロード: 300-600回
  - Pinterest検索: 900-1,800回
  - その他（静的ファイル等）: 800-600回
- **CPU時間**: 約10-20時間/月
- **メモリ時間**: 約10-20時間/月

**想定コスト**: **¥0（無料枠内）**

※ 無料枠を大幅に下回るため、Cloud Runのコストは発生しません。

---

### 2. Google Gemini API（画像分析）

#### 料金体系（2024年時点）
- **gemini-pro-vision** または **gemini-1.5-pro**:
  - **入力**: $0.25 / 1Mトークン
  - **出力**: $1.00 / 1Mトークン
  - **画像**: 画像1枚あたり約257トークンとして計算

#### 無料枠
- **無料枠**: 月60リクエスト/分（レート制限）
- **無料クレジット**: 新規登録時に$300（90日間有効）

#### コスト計算（月間想定）
- **画像分析回数**: 300-600回/月
- **1回あたりのトークン数**: 
  - 入力: 約1,000トークン（プロンプト + 画像）
  - 出力: 約500トークン（分析結果）
- **月間トークン数**:
  - 入力: 300,000-600,000トークン（0.3-0.6Mトークン）
  - 出力: 150,000-300,000トークン（0.15-0.3Mトークン）

**コスト計算**:
- 入力: 0.3-0.6Mトークン × $0.25 = $0.075-0.15
- 出力: 0.15-0.3Mトークン × $1.00 = $0.15-0.30
- **合計**: $0.225-0.45/月

**想定コスト**: **¥35-70/月**（$1 = ¥150換算）

※ 無料クレジット期間中（最初の90日間）は実質無料

---

### 3. Pinterest検索（スクレイピング）

#### コスト
- **直接的なコスト**: ¥0（API不使用）
- **間接的なコスト**: Cloud RunのCPU/メモリ使用量に含まれる

**想定コスト**: **¥0**（Cloud Runの無料枠内）

---

### 4. Google Cloud Storage（オプション：一時的な画像保存）

#### 無料枠
- **ストレージ**: 月5GBまで無料
- **読み取り操作**: 月5,000回まで無料
- **書き込み操作**: 月5,000回まで無料

#### 想定使用量
- **画像保存**: 不要（要件では保存しない）
- **使用量**: ほぼ0

**想定コスト**: **¥0**（使用しない想定）

---

### 5. Secret Manager（APIキー管理）

#### 無料枠
- **シークレットバージョン**: 月6個まで無料
- **アクセス操作**: 月10,000回まで無料

#### 想定使用量
- **シークレット数**: 1-2個（Gemini APIキー）
- **アクセス回数**: 月3,000-6,000回

**想定コスト**: **¥0**（無料枠内）

---

### 6. Cloud Build（CI/CD）

#### 無料枠
- **ビルド時間**: 月120分まで無料
- **1回のビルド**: 約5-10分

#### 想定使用量
- **月間ビルド回数**: 10-20回
- **月間ビルド時間**: 50-200分

**想定コスト**: **¥0-500/月**
- 無料枠内（120分以内）: ¥0
- 超過時: 超過分 × $0.003/分 = 約¥0-30/月

---

### 7. ネットワーク転送（エグレス）

#### 無料枠
- **同一リージョン内**: 無料
- **同一大陸内**: 月1GBまで無料
- **大陸間**: 有料

#### 想定使用量
- **画像アップロード**: 300-600回 × 平均5MB = 1.5-3GB/月
- **画像ダウンロード（Pinterest）**: 900-1,800回 × 平均0.5MB = 0.45-0.9GB/月
- **合計**: 約2-4GB/月

**想定コスト**: **¥0-200/月**
- 同一リージョン内: ¥0
- 同一大陸内: 超過分 × $0.12/GB = 約¥0-200/月

---

## 📈 月間コスト合計（検証フェーズ）

| サービス | 想定コスト |
|---------|-----------|
| Cloud Run | ¥0 |
| Gemini API | ¥35-70 |
| Pinterest検索 | ¥0 |
| Cloud Storage | ¥0 |
| Secret Manager | ¥0 |
| Cloud Build | ¥0-500 |
| ネットワーク転送 | ¥0-200 |
| **合計** | **¥35-770/月** |

### 無料クレジット期間中（最初の90日間）
- **実質コスト**: **¥0-500/月**（Gemini APIが無料クレジットでカバー）

---

## 🎯 月1万円以内での運用可能性

### ✅ 結論：**十分に可能**

検証フェーズでの想定コストは **¥35-770/月** であり、月1万円の予算内に収まります。

### コスト削減のポイント

1. **無料枠の活用**
   - Cloud Run、Secret Manager、Cloud Storageは無料枠内で運用可能
   - 無料クレジット期間中はGemini APIも実質無料

2. **リソースの最適化**
   - 最小インスタンス数を0に設定（コールドスタート許容）
   - 不要なサービスは使用しない

3. **使用量の監視**
   - Cloud Billingで予算アラートを設定
   - 月1万円の予算アラートを設定して超過を防止

---

## 📊 スケール時のコスト見積もり

### 本番運用時の想定（参考）

#### 想定使用量（本番）
- **ユーザー数**: 10-50名
- **1日あたりの画像分析**: 100-500回
- **月間の画像分析**: 3,000-15,000回

#### コスト見積もり（本番）
- **Cloud Run**: ¥0-1,000/月（無料枠を超える可能性）
- **Gemini API**: ¥350-3,500/月
- **その他**: ¥0-1,000/月
- **合計**: **¥350-5,500/月**

※ 本番運用時も月1万円以内で運用可能

---

## ⚠️ 注意事項

1. **Gemini APIの料金変動**
   - API料金は変更される可能性があります
   - 最新の料金は公式ドキュメントで確認してください

2. **ネットワーク転送コスト**
   - リージョン外への転送は追加コストが発生します
   - 可能な限り同一リージョン内で運用することを推奨

3. **予算アラートの設定**
   - GCPの予算アラートを設定して、予期しないコスト超過を防止
   - 月1万円の予算アラートを推奨

4. **無料クレジットの期限**
   - 新規登録時の$300無料クレジットは90日間のみ有効
   - 期限後は実際の使用量に応じた課金が発生

---

## 🔧 コスト最適化の推奨事項

1. **Cloud Runの設定**
   - 最小インスタンス数: 0（コールドスタート許容）
   - CPU: 1 vCPU
   - メモリ: 512MB（必要に応じて調整）

2. **Gemini APIの使用**
   - 無料クレジット期間中に検証を完了
   - 使用量を監視して不要な呼び出しを削減

3. **キャッシングの活用**
   - 同じ画像の分析結果をキャッシュ（必要に応じて）
   - 検索結果のキャッシュ（実装次第）

4. **モニタリング**
   - Cloud Billingでコストを定期的に確認
   - 予算アラートを設定

---

## 📝 まとめ

- **検証フェーズ**: ¥35-770/月（無料クレジット期間中は¥0-500/月）
- **本番運用時**: ¥350-5,500/月（想定）
- **予算**: 月1万円以内で十分に運用可能 ✅

無料枠と無料クレジットを活用することで、検証フェーズではほぼ無料で運用できます。

