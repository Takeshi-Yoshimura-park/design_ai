# 500エラー対処方法

## 🔍 エラーの確認方法

### 1. 開発サーバーのログを確認

開発サーバーを起動しているターミナルで、エラーログを確認してください。

エラーログには以下のような情報が表示されます：
- `Analysis error:` - エラーの詳細
- `Error stack:` - エラーのスタックトレース
- `Error details:` - エラーの詳細情報

### 2. ブラウザのコンソールを確認

1. ブラウザで `http://localhost:3000` を開く
2. F12キーを押して開発者ツールを開く
3. Consoleタブを開く
4. エラーメッセージを確認

### 3. NetworkタブでAPIリクエストを確認

1. 開発者ツールのNetworkタブを開く
2. 画像をアップロード
3. `/api/analyze` のリクエストをクリック
4. Responseタブでエラーメッセージを確認

## 🛠️ よくある原因と対処法

### 原因1: Gemini APIのモデル名が間違っている

**症状**: `404 Not Found` または `models/xxx is not found`

**対処法**:
- コードを更新しました。複数のモデル名を自動的に試すようになっています
- 開発サーバーを再起動してください

```bash
# 開発サーバーを停止（Ctrl+C）
# 再起動
cd ~/design_ai/app
npm run dev
```

### 原因2: APIキーが無効または権限がない

**症状**: `403 Forbidden` または `permission denied`

**対処法**:
1. [Google AI Studio](https://makersuite.google.com/app/apikey) で新しいAPIキーを取得
2. `.env.local` ファイルを更新
3. 開発サーバーを再起動

### 原因3: APIキーが設定されていない

**症状**: `GEMINI_API_KEY is not set`

**対処法**:
1. `.env.local` ファイルを確認
2. APIキーが正しく設定されているか確認
3. 開発サーバーを再起動

### 原因4: 画像の形式が対応していない

**症状**: `対応していないファイル形式です`

**対処法**:
- JPG, PNG, GIF, WebP形式の画像を使用してください

## 🔧 デバッグ手順

### ステップ1: 開発サーバーのログを確認

ターミナルで以下のようなエラーメッセージを探してください：

```
Analysis error: [エラーメッセージ]
Error stack: [スタックトレース]
Error details: [詳細情報]
```

### ステップ2: エラーメッセージに基づいて対処

エラーメッセージの内容に応じて、上記の対処法を試してください。

### ステップ3: まだ解決しない場合

1. 開発サーバーを再起動
2. ブラウザのキャッシュをクリア
3. 別の画像で試す
4. エラーメッセージの全文を確認

## 📝 改善した点

以下の改善を行いました：

1. **エラーハンドリングの改善**
   - より詳細なエラーメッセージを返すようにしました
   - 開発環境ではエラーの詳細情報を表示します

2. **複数モデルの自動試行**
   - `gemini-1.5-flash`, `gemini-pro`, `gemini-1.5-pro` を順番に試します
   - 404エラーの場合は次のモデルを自動的に試します

3. **ログの改善**
   - どのモデルを試しているかログに表示されます
   - エラーの詳細情報をログに出力します

## 🚀 次のステップ

1. 開発サーバーを再起動
2. ブラウザで再度画像をアップロード
3. エラーメッセージを確認
4. まだエラーが発生する場合は、エラーメッセージの全文を共有してください

